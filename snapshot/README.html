<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/README.md at 2018-08-08
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180808" />
    <meta http-equiv="Content-Language" content="en" />
    <title>maven-build &#x2013; maven-build</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">DOCUMENTATION <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="README.html" title="README">README</a></li>
            <li><a href="GITFLOW_RELEASE.html" title="How to release Apache Maven projects">How to release Apache Maven projects</a></li>
            <li><a href="MVN_DEPLOY_PUBLISH_SEGREGATION.html" title="mvn deploy and artifacts publish segregation">mvn deploy and artifacts publish segregation</a></li>
            <li><a href="TRAVISCI.html" title="travis-ci build">travis-ci build</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="build-docker/index.html" title="build-docker">build-docker</a></li>
            <li><a href="#" title="-----">-----</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="build-docker/index.html" title="build-docker">build-docker</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="ci-management.html" title="CI Management">CI Management</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="index.html" title="About">About</a></li>
                  <li><a href="issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="modules.html" title="Project Modules">Project Modules</a></li>
                  <li><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
                  <li><a href="scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="summary.html" title="Summary">Summary</a></li>
                  <li><a href="team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>maven-build</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-08-08<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.1.4-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">DOCUMENTATION</li>
    <li class="active"><a href="#"><span class="none"></span>README</a></li>
    <li><a href="GITFLOW_RELEASE.html" title="How to release Apache Maven projects"><span class="none"></span>How to release Apache Maven projects</a></li>
    <li><a href="MVN_DEPLOY_PUBLISH_SEGREGATION.html" title="mvn deploy and artifacts publish segregation"><span class="none"></span>mvn deploy and artifacts publish segregation</a></li>
    <li><a href="TRAVISCI.html" title="travis-ci build"><span class="none"></span>travis-ci build</a></li>
      <li class="nav-header">Projects</li>
    <li><a href="build-docker/index.html" title="build-docker"><span class="none"></span>build-docker</a></li>
    <li><a href="#" title="-----"><span class="none"></span>-----</a></li>
      <li class="nav-header">Modules</li>
    <li><a href="build-docker/index.html" title="build-docker"><span class="none"></span>build-docker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>maven-build</h1>
<p><a class="externalLink" href="https://sonarcloud.io/dashboard?id=cn.home1%3Amaven-build"><img src="https://sonarcloud.io/api/project_badges/measure?project=cn.home1%3Amaven-build&amp;metric=alert_status" alt="Sonar" /></a><br />
<a class="externalLink" href="https://ci-and-cd.github.io/ci-and-cd/snapshot/index.html">Maven Site (github.io)</a><br />
<a class="externalLink" href="https://maven-site.infra.top/ci-and-cd/maven-build/snapshot/staging/index.html">Maven site (infra.top)</a><br />
<a class="externalLink" href="https://github.com/ci-and-cd/maven-build/tree/develop">Source Repository</a><br />
<a class="externalLink" href="https://travis-ci.org/ci-and-cd/maven-build"><img src="https://travis-ci.org/ci-and-cd/maven-build.svg?branch=develop" alt="Build Status" />travis-ci</a><br />
<a class="externalLink" href="https://ci.appveyor.com/project/chshawkn/maven-build"><img src="https://ci.appveyor.com/api/projects/status/kacuklbdu48bt7l1?svg=true" alt="Build status" />appveyor</a></p>
<p>Parent pom for maven based projects</p>
<p>maven-build support code environment segregation and build deploy segregation.</p>
<div class="section">
<h2><a name="I._Usage"></a>I. Usage</h2>
<p>Set maven-build as parent in maven projects.</p>

<div>
<div>
<pre class="source">    &lt;parent&gt;
        &lt;groupId&gt;cn.home1&lt;/groupId&gt;
        &lt;artifactId&gt;maven-build&lt;/artifactId&gt;
        &lt;version&gt;${maven-build.version}&lt;/version&gt;
    &lt;/parent&gt;
</pre></div></div>

<p>No dependency will be imported, maven-build only responsible for software engineering, it does not interfering dependency management.</p>
<p>You need to provide few properties and environment variables, see next chapter.</p></div>
<div class="section">
<h2><a name="II._Properties.2C_Environment_variables_and_their_default_values"></a>II. Properties, Environment variables and their default values</h2>
<div class="section">
<h3><a name="a1._fetch_or_deploy"></a>1. fetch or deploy</h3>
<ul>

<li>private-nexus3.repository</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="http://nexus3:28081/nexus/repository">http://nexus3:28081/nexus/repository</a> Set this property to a real world url.</p>
</blockquote>
<ul>

<li>private-nexus3.repository</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="http://nexus3.localal:28081/nexus/repository">http://nexus3.localal:28081/nexus/repository</a> Set this property to a real world url.</p>
</blockquote>
<ul>

<li>build.publish.channel</li>
</ul>
<blockquote>

<p>default: snapshot Set this property to &#x2018;release&#x2019; when building release artifact. Note: CI_OPT_GITHUB_SITE_REPO_OWNER</p>
</blockquote></div>
<div class="section">
<h3><a name="a2._maven-surefire-plugin_and_maven-failsafe-plugin"></a>2. maven-surefire-plugin and maven-failsafe-plugin</h3>
<ul>

<li>maven.test.skip</li>
</ul>
<blockquote>

<p>default: false</p>
</blockquote>
<ul>

<li>maven.integration-test.skip</li>
</ul>
<blockquote>

<p>default: false</p>
</blockquote>
<ul>

<li>maven.test.failure.ignore</li>
</ul>
<blockquote>

<p>default: false</p>
</blockquote></div>
<div class="section">
<h3><a name="a3._com.github.eirslett:frontend-maven-plugin"></a>3. com.github.eirslett:frontend-maven-plugin</h3>
<ul>

<li>frontend.nodeDownloadRoot</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="https://nodejs.org/dist/">https://nodejs.org/dist/</a></p>
</blockquote>
<ul>

<li>frontend.npmDownloadRoot</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="http://registry.npmjs.org/npm/-/">http://registry.npmjs.org/npm/-/</a></p>
</blockquote>
<p>Customize these properties only when building front-end projects and default sites are not reachable.</p></div>
<div class="section">
<h3><a name="a4._report"></a>4. report</h3>
<div class="section">
<h4><a name="a4.1_sonarqube"></a>4.1 sonarqube</h4>
<ul>

<li>private-sonarqube.host.url</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="http://sonarqube:9000">http://sonarqube:9000</a> - private-sonarqube.host.url default: <a class="externalLink" href="http://sonarqube:9000">http://sonarqube:9000</a></p>
</blockquote>
<p>Need these properties only when profile &#x2018;sonar&#x2019; is activated.</p></div>
<div class="section">
<h4><a name="a4.2_maven-checkstyle-plugin_and_maven-pmd-plugin"></a>4.2 maven-checkstyle-plugin and maven-pmd-plugin</h4>
<ul>

<li>checkstyle.config.location</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="https://raw.githubusercontent.com/ci-and-cd/maven-build/master/src/main/checkstyle/google_checks_8.10.xml">https://raw.githubusercontent.com/ci-and-cd/maven-build/master/src/main/checkstyle/google_checks_8.10.xml</a> Need to customize when github.com is not reachable.</p>
</blockquote>
<ul>

<li>pmd.ruleset.location</li>
</ul>
<blockquote>

<p>default: <a class="externalLink" href="https://raw.githubusercontent.com/ci-and-cd/maven-build/master/src/main/pmd/pmd-ruleset-6.4.0.xml">https://raw.githubusercontent.com/ci-and-cd/maven-build/master/src/main/pmd/pmd-ruleset-6.4.0.xml</a> Need to customize when github.com is not reachable.</p>
</blockquote>
<ul>

<li>project.reporting.outputEncoding</li>
</ul>
<blockquote>

<p>default: UTF-8</p>
</blockquote></div></div>
<div class="section">
<h3><a name="a5._site"></a>5. site</h3>
<ul>

<li>site.path</li>
</ul>
<blockquote>

<p>default: ${project.artifactId}-${build.publish.channel} Customize this properties if you want to publish relative projects&#x2019;s site into same parent directory, use same value on relative projects.</p>
</blockquote>
<ul>

<li>CI_INFRA_OPT_OPENSOURCE_GIT_AUTH_TOKEN</li>
</ul>
<blockquote>

<p>default: N/A (blank) - CI_OPT_GITHUB_SITE_REPO_OWNER default: N/A (blank) - CI_OPT_GITHUB_SITE_REPO_NAME default: N/A (blank)</p>
</blockquote>
<p>Need these properties only when deploy site to github.com.</p></div>
<div class="section">
<h3><a name="a6._GPG"></a>6. GPG</h3>
<ul>

<li>CI_OPT_GPG_KEYNAME</li>
</ul>
<blockquote>

<p>default: N/A (blank) - CI_OPT_GPG_PASSPHRASE default: N/A (blank)</p>
</blockquote>
<p>Need these properties only when deploy artifacts into maven central repository.</p></div>
<div class="section">
<h3><a name="a7._maven_central"></a>7. maven central</h3>
<ul>

<li>CI_OPT_MAVEN_CENTRAL_USER</li>
</ul>
<blockquote>

<p>Maven central&#x2019;s username - CI_OPT_MAVEN_CENTRAL_PASS Maven central&#x2019;s password</p>
</blockquote>
<p>Need these properties only when deploy artifacts into maven central repository.</p></div>
<div class="section">
<h3><a name="a8._maven-compiler-plugin_and_maven-javadoc-plugin"></a>8. maven-compiler-plugin and maven-javadoc-plugin</h3>
<ul>

<li>project.build.sourceEncoding</li>
</ul>
<blockquote>

<p>default: UTF-8</p>
</blockquote></div></div>
<div class="section">
<h2><a name="III._Plugins"></a>III. Plugins</h2>
<div class="section">
<h3><a name="a1._build"></a>1. build</h3>
<p>com.github.eirslett:frontend-maven-plugin</p>
<p>com.amashchenko.maven.plugin:gitflow-maven-plugin</p>
<blockquote>

<p>GitFlow branch model</p>
</blockquote>
<p>maven-compiler-plugin with errorprone</p>
<blockquote>

<p>Source encoding. Java source and target version see maven-build-java*</p>
</blockquote>
<p>maven-enforcer-plugin</p>
<blockquote>

<p>Avoid dependency conflict</p>
</blockquote>
<p>maven-source-plugin</p>
<blockquote>

<p>Build jar of source code</p>
</blockquote>
<p>maven-surefire-plugin and maven-failsafe-plugin with includes and excludes configuration</p>
<p>pl.project13.maven:git-commit-id-plugin</p></div>
<div class="section">
<h3><a name="a2._report"></a>2. report</h3>
<p>org.asciidoctor:asciidoctor-maven-plugin org.owasp:dependency-check-maven org.codehaus.mojo:animal-sniffer-maven-plugin org.codehaus.mojo:findbugs-maven-plugin org.codehaus.mojo:jdepend-maven-plugin org.codehaus.mojo:taglist-maven-plugin org.codehaus.mojo:versions-maven-plugin maven-checkstyle-plugin maven-jxr-plugin maven-pmd-plugin maven-surefire-report-plugin</p></div>
<div class="section">
<h3><a name="a3._site"></a>3. site</h3>
<p>maven-site-plugin com.github.github:site-maven-plugin</p>
<p>maven-antrun-plugin</p>
<blockquote>

<p>auto clean &#x2018;${project.basedir}/src/site/markdown/README.md&#x2019; &#x2018;${project.basedir}/src/site/markdown/src/readme&#x2019; &#x2018;${project.basedir}/src/site/resources&#x2019;</p>
</blockquote>
<p>maven-resources-plugin</p>
<blockquote>

<p>copy &#x2018;${project.basedir}/README.md&#x2019; to &#x2018;${project.basedir}/src/site/markdown&#x2019; &#x2018;${project.basedir}/src/readme&#x2019; to &#x2018;${project.basedir}/src/site/markdown/src/readme&#x2019; &#x2018;${project.basedir}/src/readme&#x2019; to &#x2018;${project.basedir}/src/site/resources/src/readme&#x2019; &#x2018;${project.basedir}/src/site/markdown/images&#x2019; to &#x2018;${project.basedir}/src/site/resources/images&#x2019;</p>
</blockquote></div></div>
<div class="section">
<h2><a name="IV._Profiles"></a>IV. Profiles</h2>
<div class="section">
<h3><a name="a1._build"></a>1. build</h3>
<p>infrastructure_opensource</p>
<blockquote>

<p>Use maven central service. Deploy maven site to github.</p>
</blockquote>
<p>infrastructure_private</p>
<blockquote>

<p>Use nexus service at organization internal network. Deploy maven site into organization internal mvnsite.</p>
</blockquote>
<p>infrastructure_local</p>
<blockquote>

<p>Use nexus service at user&#x2019;s local (see <a href="../../docker-nexus3/README.html">docker-nexus3</a>). Deploy maven site into local mvnsite (see <a href="../../docker-proxy/README.html">docker-proxy</a>).</p>
</blockquote>
<p>git-commit-id</p>
<blockquote>

<p>Generate src/main/resources/git.properties. activate automatically if &#x2018;${maven.multiModuleProjectDirectory}/.git/HEAD&#x2019; exists</p>
</blockquote>
<p>mvn-deploy-publish-segregation-by-wagon</p>
<blockquote>

<p>activate by set &#x2018;mvn_deploy_publish_segregation&#x2019; to &#x2018;true&#x2019;</p>
</blockquote>
<p>jacoco-build</p>
<blockquote>

<p>Test coverage report. activate by property &#x2018;jacoco&#x2019; absent (Enabled by default, to disable, set <tt>-Djacoco=false</tt>)</p>
</blockquote>
<p>cobertura</p>
<blockquote>

<p>activate by set property &#x2018;jacoco&#x2019; to &#x2018;false&#x2019;</p>
</blockquote></div>
<div class="section">
<h3><a name="a2._report"></a>2. report</h3>
<p>spring-restdocs</p>
<blockquote>

<p>activate by set property &#x2018;spring-restdocs&#x2019; to &#x2018;true&#x2019;</p>
</blockquote>
<p>reports-for-site</p>
<blockquote>

<p>activate by set property &#x2018;site&#x2019; to &#x2018;true&#x2019;</p>
</blockquote>
<p>jacoco-report</p>
<blockquote>

<p>activate by set property &#x2018;jacoco&#x2019; to &#x2018;true&#x2019;</p>
</blockquote>
<p>dependency-check</p>
<blockquote>

<p>Generate a detailed dependency report, This takes a long time, disabled by default. activate by set property &#x2018;dependency-check&#x2019; to &#x2018;true&#x2019; (<tt>mvn -Ddependency-check=true</tt>), need to be used together with <tt>site</tt> profile of build-site module.</p>
</blockquote>
<p>clirr</p>
<blockquote>

<p>activate by set property &#x2018;clirr&#x2019; to &#x2018;true&#x2019;</p>
</blockquote>
<p>sonar</p>
<blockquote>

<p>activate by set property &#x2018;sonar&#x2019; to &#x2018;true&#x2019;</p>
</blockquote></div>
<div class="section">
<h3><a name="a3._site"></a>3. site</h3>
<p>site</p>
<blockquote>

<p>Generate maven site for project, run <tt>mvn -Dsite=true site site:stage site:stage-deploy</tt> to active this profile and build site, set <tt>-Dsite.path=maven-build-snapshot</tt> to specify upload directory.</p>
</blockquote>
<p>infrastructure_opensource_site_publish</p>
<blockquote>

<p>publish project site to github<br />
activate on property &#x2018;github-site-publish&#x2019; is true<br />
needs:<br />
env.CI_INFRA_OPT_OPENSOURCE_GIT_AUTH_TOKEN<br />
env.CI_OPT_GITHUB_SITE_REPO_OWNER</p>
</blockquote></div></div>
<div class="section">
<h2><a name="V._Repositories"></a>V. Repositories</h2>
<p>central, spring-libs-release, spring-milestone, spring-libs-snapshot</p></div>
<div class="section">
<h2><a name="VI._Jira_and_gitlab_integration"></a>VI. Jira and gitlab integration</h2>
<p>Add args on <tt>maven site</tt></p>

<div>
<div>
<pre class="source">jira.projectKey         # jira projectKey
jira.user               # jira username
jira.password           # jira password
</pre></div></div>
</div>
<div class="section">
<h2><a name="VII._Appendices"></a>VII. Appendices</h2>
<div class="section">
<h3><a name="A._Contribution_to_maven-build"></a>A. Contribution to maven-build</h3>
<div class="section">
<h4><a name="A.1._local_install.2Fdeploy_maven-build"></a>A.1. local install/deploy maven-build</h4>

<div>
<div>
<pre class="source">mvn -e -U clean install

mvn -e -U -Dinfrastructure=local -Dsite=true -Dsite.path=ci-and-cd clean install deploy site site:stage site:stage-deploy
</pre></div></div>
</div>
<div class="section">
<h4><a name="A.2_Pull_request"></a>A.2 Pull request</h4>
<p>Please open PR on develop branch.</p></div></div>
<div class="section">
<h3><a name="B._GPG_issue"></a>B. GPG issue</h3>

<div>
<div>
<pre class="source">gpg: signing failed: Inappropriate ioctl for device
</pre></div></div>

<p>To solve the problem, you need to enable loopback pinentry mode.</p>
<p>Add this to ~/.gnupg/gpg.conf:</p>

<div>
<div>
<pre class="source">use-agent 
pinentry-mode loopback
</pre></div></div>

<p>And add this to ~/.gnupg/gpg-agent.conf, creating the file if it doesn&#x2019;t already exist:</p>

<div>
<div>
<pre class="source">allow-loopback-pinentry
</pre></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2018.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
